import{d as Oe,l as S,c as We,o as ae,b as re,F as Ae,m as ke,k as we,p as Ne,q as xe,s as ie,v as Y,g as $,x as Le,h as _e,y as je,z as he,B as fe,a as Ie,L as He,_ as De}from"./index-DlSQSBT-.js";var Me=Object.defineProperty,ze=(a,e,t)=>e in a?Me(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,f=(a,e,t)=>(ze(a,typeof e!="symbol"?e+"":e,t),t),ye;const oe=typeof window<"u",Qe=a=>typeof a=="string",$e=()=>{};oe&&((ye=window==null?void 0:window.navigator)!=null&&ye.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function d(a){return typeof a=="function"?a():we(a)}function me(a,e=!1,t="Timeout"){return new Promise((r,n)=>{setTimeout(e?()=>n(t):r,a)})}function Xe(a){return a}function Re(a,...e){return e.some(t=>t in a)}function ee(){const a=[],e=t=>{const r=a.indexOf(t);r!==-1&&a.splice(r,1)};return{on:t=>(a.push(t),{off:()=>e(t)}),off:e,trigger:t=>{a.forEach(r=>r(t))}}}function le(a){return Ne()?(xe(a),!0):!1}function te(a){return typeof a=="function"?ie(a):S(a)}function ne(a,e=!1){function t(l,{flush:h="sync",deep:v=!1,timeout:m,throwOnTimeout:L}={}){let F=null;const C=[new Promise(B=>{F=$(a,O=>{l(O)!==e&&(F==null||F(),B(O))},{flush:h,deep:v,immediate:!0})})];return m!=null&&C.push(me(m,L).then(()=>d(a)).finally(()=>F==null?void 0:F())),Promise.race(C)}function r(l,h){if(!Le(l))return t(O=>O===l,h);const{flush:v="sync",deep:m=!1,timeout:L,throwOnTimeout:F}=h??{};let C=null;const B=[new Promise(O=>{C=$([a,l],([X,P])=>{e!==(X===P)&&(C==null||C(),O(X))},{flush:v,deep:m,immediate:!0})})];return L!=null&&B.push(me(L,F).then(()=>d(a)).finally(()=>(C==null||C(),d(a)))),Promise.race(B)}function n(l){return t(h=>!!h,l)}function o(l){return r(null,l)}function i(l){return r(void 0,l)}function y(l){return t(Number.isNaN,l)}function s(l,h){return t(v=>{const m=Array.from(v);return m.includes(l)||m.includes(d(l))},h)}function u(l){return p(1,l)}function p(l=1,h){let v=-1;return t(()=>(v+=1,v>=l),h)}return Array.isArray(d(a))?{toMatch:t,toContains:s,changed:u,changedTimes:p,get not(){return ne(a,!e)}}:{toMatch:t,toBe:r,toBeTruthy:n,toBeNull:o,toBeNaN:y,toBeUndefined:i,changed:u,changedTimes:p,get not(){return ne(a,!e)}}}function Ue(a){return ne(a)}function Ve(a,e,t={}){const{immediate:r=!0}=t,n=S(!1);let o=null;function i(){o&&(clearTimeout(o),o=null)}function y(){n.value=!1,i()}function s(...u){i(),n.value=!0,o=setTimeout(()=>{n.value=!1,o=null,a(...u)},d(e))}return r&&(n.value=!0,oe&&s()),le(y),{isPending:n,start:s,stop:y}}function qe(a){var e;const t=d(a);return(e=t==null?void 0:t.$el)!=null?e:t}const se=oe?window:void 0;function H(...a){let e,t,r,n;if(Qe(a[0])||Array.isArray(a[0])?([t,r,n]=a,e=se):[e,t,r,n]=a,!e)return $e;Array.isArray(t)||(t=[t]),Array.isArray(r)||(r=[r]);const o=[],i=()=>{o.forEach(p=>p()),o.length=0},y=(p,l,h)=>(p.addEventListener(l,h,n),()=>p.removeEventListener(l,h,n)),s=$(()=>qe(e),p=>{i(),p&&o.push(...t.flatMap(l=>r.map(h=>y(p,l,h))))},{immediate:!0,flush:"post"}),u=()=>{s(),i()};return le(u),u}const ve=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ge="__vueuse_ssr_handlers__";ve[ge]=ve[ge]||{};function Ge(a,e={}){const{immediate:t=!0,window:r=se}=e,n=S(!1);let o=null;function i(){!n.value||!r||(a(),o=r.requestAnimationFrame(i))}function y(){!n.value&&r&&(n.value=!0,i())}function s(){n.value=!1,o!=null&&r&&(r.cancelAnimationFrame(o),o=null)}return t&&y(),le(s),{isActive:n,pause:s,resume:y}}var Je=Object.defineProperty,Ke=Object.defineProperties,Ze=Object.getOwnPropertyDescriptors,be=Object.getOwnPropertySymbols,Ye=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable,Fe=(a,e,t)=>e in a?Je(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,c=(a,e)=>{for(var t in e||(e={}))Ye.call(e,t)&&Fe(a,t,e[t]);if(be)for(var t of be(e))et.call(e,t)&&Fe(a,t,e[t]);return a},E=(a,e)=>Ke(a,Ze(e));const tt={json:"application/json",text:"text/plain",formData:"multipart/form-data"};function G(a){return Re(a,"immediate","refetch","initialData","timeout","beforeFetch","afterFetch","onFetchError","fetch")}function at(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function Q(a){return typeof Headers<"u"&&a instanceof Headers?Object.fromEntries([...a.entries()]):a}function N(a,...e){return a==="overwrite"?async t=>{const r=e[e.length-1];return r!==void 0&&await r(t),t}:async t=>(await e.reduce((r,n)=>r.then(async()=>{n&&(t=c(c({},t),await n(t)))}),Promise.resolve()),t)}function rt(a={}){const e=a.combination||"chain",t=a.options||{},r=a.fetchOptions||{};function n(o,...i){const y=ie(()=>{const p=d(a.baseUrl),l=d(o);return p&&!at(l)?it(p,l):l});let s=t,u=r;return i.length>0&&(G(i[0])?s=E(c(c({},s),i[0]),{beforeFetch:N(e,t.beforeFetch,i[0].beforeFetch),afterFetch:N(e,t.afterFetch,i[0].afterFetch),onFetchError:N(e,t.onFetchError,i[0].onFetchError)}):u=E(c(c({},u),i[0]),{headers:c(c({},Q(u.headers)||{}),Q(i[0].headers)||{})})),i.length>1&&G(i[1])&&(s=E(c(c({},s),i[1]),{beforeFetch:N(e,t.beforeFetch,i[1].beforeFetch),afterFetch:N(e,t.afterFetch,i[1].afterFetch),onFetchError:N(e,t.onFetchError,i[1].onFetchError)})),nt(y,u,s)}return n}function nt(a,...e){var t;const r=typeof AbortController=="function";let n={},o={immediate:!0,refetch:!1,timeout:0};const i={method:"GET",type:"text",payload:void 0};e.length>0&&(G(e[0])?o=c(c({},o),e[0]):n=e[0]),e.length>1&&G(e[1])&&(o=c(c({},o),e[1]));const{fetch:y=(t=se)==null?void 0:t.fetch,initialData:s,timeout:u}=o,p=ee(),l=ee(),h=ee(),v=S(!1),m=S(!1),L=S(!1),F=S(null),C=Y(null),B=Y(null),O=Y(s),X=ie(()=>r&&m.value);let P,_;const ue=()=>{r&&P&&P.abort()},K=g=>{m.value=g,v.value=!g};u&&(_=Ve(ue,u,{immediate:!1}));const R=async(g=!1)=>{var W;K(!0),B.value=null,F.value=null,L.value=!1,P=void 0,r&&(P=new AbortController,P.signal.onabort=()=>L.value=!0,n=E(c({},n),{signal:P.signal}));const T={method:i.method,headers:{}};if(i.payload){const V=Q(T.headers);i.payloadType&&(V["Content-Type"]=(W=tt[i.payloadType])!=null?W:i.payloadType);const q=d(i.payload);T.body=i.payloadType==="json"?JSON.stringify(q):q}let I=!1;const k={url:d(a),options:c(c({},T),n),cancel:()=>{I=!0}};if(o.beforeFetch&&Object.assign(k,await o.beforeFetch(k)),I||!y)return K(!1),Promise.resolve(null);let w=null;return _&&_.start(),new Promise((V,q)=>{var de;y(k.url,E(c(c({},T),k.options),{headers:c(c({},Q(T.headers)),Q((de=k.options)==null?void 0:de.headers))})).then(async b=>{if(C.value=b,F.value=b.status,w=await b[i.type](),o.afterFetch&&F.value>=200&&F.value<300&&({data:w}=await o.afterFetch({data:w,response:b})),O.value=w,!b.ok)throw new Error(b.statusText);return p.trigger(b),V(b)}).catch(async b=>{let pe=b.message||b.name;return o.onFetchError&&({data:w,error:pe}=await o.onFetchError({data:w,error:b,response:C.value})),O.value=w,B.value=pe,l.trigger(b),g?q(b):V(null)}).finally(()=>{K(!1),_&&_.stop(),h.trigger(null)})})},ce=te(o.refetch);$([ce,te(a)],([g])=>g&&R(),{deep:!0});const U={isFinished:v,statusCode:F,response:C,error:B,data:O,isFetching:m,canAbort:X,aborted:L,abort:ue,execute:R,onFetchResponse:p.on,onFetchError:l.on,onFetchFinally:h.on,get:A("GET"),put:A("PUT"),post:A("POST"),delete:A("DELETE"),patch:A("PATCH"),head:A("HEAD"),options:A("OPTIONS"),json:j("json"),text:j("text"),blob:j("blob"),arrayBuffer:j("arrayBuffer"),formData:j("formData")};function A(g){return(W,T)=>{if(!m.value){i.method=g,i.payload=W,i.payloadType=T,Le(i.payload)&&$([ce,te(i.payload)],([k])=>k&&R(),{deep:!0});const I=d(i.payload);return!T&&I&&Object.getPrototypeOf(I)===Object.prototype&&(i.payloadType="json"),E(c({},U),{then(k,w){return Z().then(k,w)}})}}}function Z(){return new Promise((g,W)=>{Ue(v).toBe(!0).then(()=>g(U)).catch(T=>W(T))})}function j(g){return()=>{if(!m.value)return i.type=g,E(c({},U),{then(W,T){return Z().then(W,T)}})}}return o.immediate&&setTimeout(R,0),E(c({},U),{then(g,W){return Z().then(g,W)}})}function it(a,e){return!a.endsWith("/")&&!e.startsWith("/")?`${a}/${e}`:`${a}${e}`}var Ce;(function(a){a.UP="UP",a.RIGHT="RIGHT",a.DOWN="DOWN",a.LEFT="LEFT",a.NONE="NONE"})(Ce||(Ce={}));var ot=Object.defineProperty,Te=Object.getOwnPropertySymbols,lt=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable,Se=(a,e,t)=>e in a?ot(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,ut=(a,e)=>{for(var t in e||(e={}))lt.call(e,t)&&Se(a,t,e[t]);if(Te)for(var t of Te(e))st.call(e,t)&&Se(a,t,e[t]);return a};const ct={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};ut({linear:Xe},ct);const J=a=>a===void 0;function x(a,e){const t=d(a);return J(t)?e:Number(t)}function dt(a,e){const t=d(a);return Array.isArray(t)?t:t?String(t):e}function D(a,e){const t=d(a);return J(t)?e:String(t)}function M(a,e){const t=d(a);return J(t)?e:!!t}const pt={src:{type:String,default:null},audioControls:{type:Boolean,default:!0},corsAnonym:{type:Boolean,default:!1},canvWidth:{type:Number,default:300},canvHeight:{type:Number,default:80},canvFillColor:{type:[String,Array],default:""},placeholder:{type:Boolean,default:!0}},ht={canvWidth:{type:Number,default:500},canvHeight:{type:Number,default:80},playedLineWidth:{type:Number,default:.5},playedLineColor:{type:String,default:"navy"},noplayedLineWidth:{type:Number,default:.5},noplayedLineColor:{type:String,default:"lime"},playtime:{type:Boolean,default:!0},playtimeWithMs:{type:Boolean,default:!0},playtimeFontSize:{type:Number,default:12},playtimeFontFamily:{type:String,default:"monospace"},playtimeFontColor:{type:String,default:"grey"},playtimeTextBottom:{type:Boolean,default:!1},playtimeSlider:{type:Boolean,default:!0},playtimeSliderColor:{type:String,default:"red"},playtimeSliderWidth:{type:Number,default:1},playtimeClickable:{type:Boolean,default:!0},requester:{type:Function,default:fetch}},Be={...pt,...ht};function ft(){return Be}class yt{constructor(e){f(this,"src"),f(this,"canvWidth"),f(this,"canvHeight"),f(this,"canvFillColor"),f(this,"currentTime"),f(this,"duration"),f(this,"playedLineWidth"),f(this,"playedLineColor"),f(this,"noplayedLineWidth"),f(this,"noplayedLineColor"),f(this,"playtime"),f(this,"playtimeWithMs"),f(this,"playtimeFontSize"),f(this,"playtimeFontFamily"),f(this,"playtimeFontColor"),f(this,"playtimeTextBottom"),f(this,"playtimeSlider"),f(this,"playtimeSliderColor"),f(this,"playtimeSliderWidth"),f(this,"playtimeClickable"),f(this,"peaks",[]);const t=Be;this.canvWidth=x(e.canvWidth,t.canvWidth.default),this.canvHeight=x(e.canvHeight,t.canvHeight.default),this.canvFillColor=dt(e.canvFillColor,t.canvFillColor.default),this.playedLineWidth=x(e.playedLineWidth,t.playedLineWidth.default),this.playedLineColor=D(e.playedLineColor,t.playedLineColor.default),this.noplayedLineWidth=x(e.noplayedLineWidth,t.noplayedLineWidth.default),this.noplayedLineColor=D(e.noplayedLineColor,t.noplayedLineColor.default),this.playtime=M(e.playtime,t.playtime.default),this.playtimeWithMs=M(e.playtimeWithMs,t.playtimeWithMs.default),this.playtimeFontSize=x(e.playtimeFontSize,t.playtimeFontSize.default),this.playtimeFontFamily=D(e.playtimeFontFamily,t.playtimeFontFamily.default),this.playtimeFontColor=D(e.playtimeFontColor,t.playtimeFontColor.default),this.playtimeTextBottom=M(e.playtimeTextBottom,t.playtimeTextBottom.default),this.playtimeSlider=M(e.playtimeSlider,t.playtimeSlider.default),this.playtimeSliderColor=D(e.playtimeSliderColor,t.playtimeSliderColor.default),this.playtimeSliderWidth=x(e.playtimeSliderWidth,t.playtimeSliderWidth.default),this.playtimeClickable=M(e.playtimeClickable,t.playtimeClickable.default),this.src=J(e.src)?null:String(e.src),this.currentTime=0,this.duration=0}get playX(){if(!this.duration)return 0;const e=~~(this.currentTime/this.duration*this.canvWidth);return e>this.canvWidth?this.canvWidth:e}get timePlayed(){const e=[this.currentTime/3600,this.currentTime/60%60,this.currentTime%60].map(r=>String(~~r).padStart(2,"0")).join(":");if(!this.playtimeWithMs)return e;const t=~~(this.currentTime%1*1e3);return[e,String(t).padStart(3,"0")].join(".")}setPeaks(e){this.peaks.slice(0);let t=0,r=0,n=0,o=0;const i=Math.ceil(e.length/this.canvWidth),y=this.canvWidth,s=this.canvHeight;for(let u=0;u<e.numberOfChannels;u++){const p=e.getChannelData(u);for(let l=0;l<y;l++){const h=~~(l*i),v=~~(h+i);t=0,r=0;for(let m=h;m<v;m++)t=p[m]<t?p[m]:t,r=p[m]>r?p[m]:r;this.peaks[l]&&(this.peaks[l][0]=this.peaks[l][0]<r?r:this.peaks[l][0],this.peaks[l][1]=this.peaks[l][1]>t?t:this.peaks[l][1]),this.peaks[l]=[r,t]}}for(let u=0;u<this.peaks.length;u++)r=this.peaks[u][0],t=this.peaks[u][1],n=s/2-r*s/2,o=s/2-t*s/2,this.peaks[u]=[n,o===n?n+1:o]}}function mt(a,e){const t=S(null);return ke(()=>{const r=d(a);!r||(t.value=r.getContext("2d"),r.width=e.canvWidth,r.height=e.canvHeight)}),t}Array(16).fill(0);function vt(a,e,t,r={}){const n=new yt(t),o=mt(e,n);gt(o,n,r);const{pause:i,resume:y}=Ge(()=>{var s,u;n.currentTime=(u=(s=a==null?void 0:a.value)==null?void 0:s.currentTime)!=null?u:0,z(o,n)},{immediate:!1});H(a,"play",y),H(a,"pause",i),H(a,"ended",()=>{const s=d(a);!s||s.duration===n.duration||(n.duration=s.duration,z(o,n))}),H(a,"timeupdate",()=>{const s=d(a);!s||(n.currentTime=s.currentTime,z(o,n))}),H(e,"click",s=>{if(!n.playtimeClickable)return;const u=d(a);!u||(u.currentTime=s.offsetX/n.canvWidth*n.duration,n.currentTime=u.currentTime,z(o,n))})}function z(a,e){const t=d(a);if(!t)return;let r=0;t.clearRect(0,0,e.canvWidth,e.canvHeight);const n=(o,i,y,s)=>{for(t.lineWidth=y,t.strokeStyle=s,i=i>e.peaks.length?e.peaks.length:i,t.beginPath();o<i;o++)t.moveTo(o,e.peaks[o][0]),t.lineTo(o,e.peaks[o][1]);return t.stroke(),o};r=n(r,e.playX,e.playedLineWidth,e.playedLineColor),n(r,e.peaks.length,e.noplayedLineWidth,e.noplayedLineColor),Pe(t,e),e.playtime&&Ee(t,e)}function Pe(a,e){a.lineWidth=e.playtimeSliderWidth,a.strokeStyle=e.playtimeSliderColor,a.beginPath(),a.moveTo(e.playX,0),a.lineTo(e.playX,e.canvHeight),a.stroke()}function Ee(a,e){const t=e.timePlayed,r=3,n=~~a.measureText(t).width,o=e.playX>e.canvWidth-n-r?e.playX-n-r:e.playX+r,i=e.playtimeTextBottom?e.canvHeight-e.playtimeFontSize+r:e.playtimeFontSize+r;a.fillStyle=e.playtimeFontColor,a.font=`${e.playtimeFontSize}px ${e.playtimeFontFamily}`,a.fillText(t,o,i)}function gt(a,e,t){e.src&&(rt(t)(e.src).arrayBuffer().then(({error:r,data:n})=>{const o=d(r);if(o!==null){console.error(`Failed get url '${e.src}': ${o}`);return}if(n.value===null){console.error("invalid arrayBuffer data received");return}new AudioContext().decodeAudioData(n.value).then(i=>{e.duration=i.duration,e.setPeaks(i),z(a,e)}).catch(i=>{console.error("Failed to decode audio array buffer:",i)})}),ke(()=>{const r=d(a);!r||(r.lineWidth=e.noplayedLineWidth,r.strokeStyle=e.noplayedLineColor,r.beginPath(),r.moveTo(0,e.canvHeight/2),r.lineTo(e.canvWidth,e.canvHeight/2),r.stroke(),Pe(r,e),e.playtime&&Ee(r,e))}))}const bt=["controls","src"],Ft=Oe({__name:"AVWaveform",props:ft(),setup(a){const e=a,t=S(null),r=S(null);return vt(t,r,e,{options:{refetch:!0},fetchOptions:{mode:"cors"}}),(n,o)=>(ae(),We(Ae,null,[re("audio",{ref_key:"player",ref:t,controls:e.audioControls,src:e.src},null,8,bt),re("canvas",{ref_key:"canvas",ref:r},null,512)],64))}}),Ct={class:"root"},Tt=["src"],St=Oe({__name:"AudioHandler",props:{src:{}},setup(a){const e=S(!1),t=S(300);function r(){e.value=!0}return(n,o)=>(ae(),We("div",Ct,[e.value?je("",!0):(ae(),_e(He,{key:0})),he(re("audio",{src:a.src,onCanplay:r},null,40,Tt),[[fe,!1]]),he(Ie(we(Ft),{src:a.src,"canv-width":t.value,"noplayed-line-color":"hsl(150deg 63% 75%)","played-line-color":"hsl(167deg 69% 48%)","playtime-slider-color":"hsl(263deg 64% 72%)","playtime-font-family":"'Fira Code', monospace","playtime-font-color":"hsl(0deg 0% 100% / 90%)"},null,8,["src","canv-width"]),[[fe,e.value]])]))}}),Wt=De(St,[["__scopeId","data-v-8de45ec3"]]);export{Wt as A};
